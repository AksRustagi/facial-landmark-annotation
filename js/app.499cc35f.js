(function(e){function t(t){for(var a,s,c=t[0],i=t[1],u=t[2],f=0,d=[];f<c.length;f++)s=c[f],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&d.push(r[s][0]),r[s]=0;for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a]);l&&l(t);while(d.length)d.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],a=!0,c=1;c<n.length;c++){var i=n[c];0!==r[i]&&(a=!1)}a&&(o.splice(t--,1),e=s(s.s=n[0]))}return e}var a={},r={app:0},o=[];function s(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=a,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="facial-landmark-annotation/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],i=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=i;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},1:function(e,t){},2:function(e,t){},"28ab":function(e,t,n){},3:function(e,t){},"41ec":function(e,t,n){"use strict";var a=n("46e9"),r=n.n(a);r.a},"46e9":function(e,t,n){},"46f4":function(e,t,n){},"51ea":function(e,t,n){"use strict";var a=n("a97f"),r=n.n(a);r.a},"6d13":function(e,t,n){"use strict";var a=n("9f36"),r=n.n(a);r.a},"790c":function(e,t,n){"use strict";var a=n("28ab"),r=n.n(a);r.a},"8ef2":function(e,t,n){"use strict";var a=n("ea3f"),r=n.n(a);r.a},"9f36":function(e,t,n){},a97f:function(e,t,n){},b795:function(e,t,n){"use strict";var a=n("46f4"),r=n.n(a);r.a},c690:function(e,t,n){},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},o=[],s=(n("cf25"),n("2877")),c={},i=Object(s["a"])(c,r,o,!1,null,null,null),u=i.exports,l=n("8c4f"),f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home"},[n("Menu"),n("div",{staticClass:"editor"},[n("LandmarkEditor",{staticClass:"landmark-editor"}),n("DetailTable",{staticClass:"detail-table"})],1),n("Controls"),n("Timeline"),n("b-loading",{attrs:{active:e.isLoading},on:{"update:active":function(t){e.isLoading=t}}})],1)},d=[],h=(n("d3b7"),n("96cf"),n("d4ec")),p=n("bee2"),m=n("99de"),v=n("7e84"),b=n("262e"),y=n("9ab4"),g=n("60a3"),k=n("ab39"),w=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"controls cotainer"},[n("div",{staticClass:"columns"},[n("b-field",{staticClass:"column",attrs:{label:"Frame:"}},[n("b-tooltip",{attrs:{label:"Prev: (,) Next: (.)",type:"is-light"}},[n("b-numberinput",{attrs:{"controls-position":"compact",min:"0",max:e.total},model:{value:e.current,callback:function(t){e.current=t},expression:"current"}})],1)],1),n("b-field",{staticClass:"column",attrs:{label:"Commands:"}},[n("div",{staticClass:"columns"},[n("div",{staticClass:"column"},[n("button",{staticClass:"button",on:{click:e.startAutoProcess}},[e._v("Start Auto")])])])]),n("b-field",{staticClass:"column",attrs:{label:"Threshold:"}},[n("b-numberinput",{attrs:{"controls-position":"compact",min:"0",max:"1",step:"0.05"},model:{value:e.scoreThreshold,callback:function(t){e.scoreThreshold=t},expression:"scoreThreshold"}})],1)],1),n("b-loading",{attrs:{active:e.isAutoProcess,canCancel:""},on:{"update:active":function(t){e.isAutoProcess=t},onCancel:e.stopAutoProcess}})],1)},O=[],j=(n("c740"),n("a434"),n("3ca3"),n("ddb0"),n("2b3d"),n("6fc5")),x=n("2f62");a["a"].use(x["a"]);var F=new x["a"].Store({}),C=(n("159b"),function(e){return regeneratorRuntime.async((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){var a=new FileReader;a.onload=function(e){t(a.result)},a.onerror=n,a.readAsText(e)})));case 1:case"end":return t.stop()}}))}),P=function(e){return Math.round(100*e)/100},S=function(e){e.rect.x=P(e.rect.x),e.rect.y=P(e.rect.y),e.rect.width=P(e.rect.width),e.rect.height=P(e.rect.height),e.landmarks.forEach((function(e){e.x=P(e.x),e.y=P(e.y)}))},D=function(e){function t(){var e;return Object(h["a"])(this,t),e=Object(m["a"])(this,Object(v["a"])(t).apply(this,arguments)),e.meta={duration:0,frames:0,width:0,height:0},e.frames=[],e}return Object(b["a"])(t,e),Object(p["a"])(t,[{key:"reduceDataSize",value:function(){this.frames.forEach((function(e){e&&e.forEach((function(e){S(e)}))}))}},{key:"setMetaData",value:function(e){this.meta=e,this.frames=new Array(Math.ceil(e.frames))}},{key:"updateFrame",value:function(e){e.faces.forEach((function(e){S(e)})),a["a"].set(this.frames,e.frame,e.faces)}},{key:"loadJsonFile",value:function(e){var t;return regeneratorRuntime.async((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap(C(e));case 2:return t=n.sent,n.abrupt("return",JSON.parse(t));case 4:case"end":return n.stop()}}))}},{key:"clearAllFrames",value:function(){this.frames=new Array(Math.ceil(this.meta.frames))}},{key:"firstBlankFrame",get:function(){for(var e=0;e<this.frames.length;e++)if(!this.frames[e])return e;return-1}},{key:"jsonBlob",get:function(){var e=JSON.stringify({meta:this.meta,frames:this.frames});return new Blob([e],{type:"application/json;charset=utf-8"})}}]),t}(j["d"]);Object(y["c"])([j["b"]],D.prototype,"reduceDataSize",null),Object(y["c"])([j["b"]],D.prototype,"setMetaData",null),Object(y["c"])([j["b"]],D.prototype,"updateFrame",null),Object(y["c"])([Object(j["c"])({mutate:["meta","frames"]})],D.prototype,"loadJsonFile",null),Object(y["c"])([j["b"]],D.prototype,"clearAllFrames",null),D=Object(y["c"])([Object(j["a"])({dynamic:!0,store:F,name:"timeline",namespaced:!0})],D);var _=Object(j["e"])(D),M=function(e){return JSON.parse(JSON.stringify(e))},T=function(e){function t(){var e;return Object(h["a"])(this,t),e=Object(m["a"])(this,Object(v["a"])(t).apply(this,arguments)),e.currentFrame=0,e.duration=0,e.fps=30,e.videoUrl="",e.isAutoProcess=!1,e.forceDetect=!1,e.faceSelected=null,e.faceCopied=null,e.faceDetectorOptions=new k["d"],e}return Object(b["a"])(t,e),Object(p["a"])(t,[{key:"nextFrame",value:function(){var e=this.fps*this.duration;e<=this.currentFrame?this.isAutoProcess=!1:(this.currentFrame++,this.faceSelected=null)}},{key:"prevFrame",value:function(){0!==this.currentFrame&&(this.currentFrame--,this.faceSelected=null)}},{key:"setCurrentFrame",value:function(e){e<0||this.totalFrame<e||(this.currentFrame=e,this.faceSelected=null)}},{key:"nextBlankFrame",value:function(){var e=_.firstBlankFrame;e<0?this.isAutoProcess=!1:this.totalFrame<e||(this.currentFrame=e)}},{key:"loadVideo",value:function(e){this.videoUrl=URL.createObjectURL(e)}},{key:"setVideoDuration",value:function(e){this.duration=e}},{key:"startAutoProcess",value:function(){this.isAutoProcess=!0}},{key:"stopAutoProcess",value:function(){this.isAutoProcess=!1}},{key:"selectFace",value:function(e){this.faceSelected=e}},{key:"copyFace",value:function(){null!==this.faceSelected&&(this.faceCopied=this.faceSelected)}},{key:"pasteFace",value:function(){null!==this.faceCopied&&R.addFace(M(this.faceCopied))}},{key:"addFace",value:function(e){var t,n=this.currentFrame,a=_.frames[n],r=e;void 0===a||null===a||0===a.length?t=[r]:function(){var e=0;for(e=0;e<=a.length;e++)if(!a.some((function(t){return t.id===e})))break;r.id=e,a.push(r),t=a}(),_.updateFrame({frame:n,faces:t})}},{key:"deleteFace",value:function(){var e=this,t=_.frames[this.currentFrame];if(null!==this.faceSelected&&null!==t&&0!==t.length){var n=t.findIndex((function(t){return t===e.faceSelected}));n>=0&&t.splice(n,1)}}},{key:"setFps",value:function(e){this.fps=e,_.clearAllFrames()}},{key:"setScoreThreshold",value:function(e){var t=this.faceDetectorOptions;this.faceDetectorOptions=new k["d"]({inputSize:t.inputSize,scoreThreshold:e})}},{key:"setForceDetect",value:function(e){this.forceDetect=e}},{key:"totalFrame",get:function(){return this.fps*this.duration}},{key:"currentTime",get:function(){return this.currentFrame/this.fps}},{key:"canCopy",get:function(){return null!==this.faceSelected}},{key:"canPaste",get:function(){return null!==this.faceCopied}}]),t}(j["d"]);Object(y["c"])([j["b"]],T.prototype,"nextFrame",null),Object(y["c"])([j["b"]],T.prototype,"prevFrame",null),Object(y["c"])([j["b"]],T.prototype,"setCurrentFrame",null),Object(y["c"])([j["b"]],T.prototype,"nextBlankFrame",null),Object(y["c"])([j["b"]],T.prototype,"loadVideo",null),Object(y["c"])([j["b"]],T.prototype,"setVideoDuration",null),Object(y["c"])([j["b"]],T.prototype,"startAutoProcess",null),Object(y["c"])([j["b"]],T.prototype,"stopAutoProcess",null),Object(y["c"])([j["b"]],T.prototype,"selectFace",null),Object(y["c"])([j["b"]],T.prototype,"copyFace",null),Object(y["c"])([j["b"]],T.prototype,"pasteFace",null),Object(y["c"])([j["b"]],T.prototype,"addFace",null),Object(y["c"])([j["b"]],T.prototype,"deleteFace",null),Object(y["c"])([j["b"]],T.prototype,"setFps",null),Object(y["c"])([j["b"]],T.prototype,"setScoreThreshold",null),Object(y["c"])([j["b"]],T.prototype,"setForceDetect",null),T=Object(y["c"])([Object(j["a"])({dynamic:!0,store:F,name:"app",namespaced:!0})],T);var R=Object(j["e"])(T),A=function(e){function t(){var e;return Object(h["a"])(this,t),e=Object(m["a"])(this,Object(v["a"])(t).apply(this,arguments)),e.scoreThreshold=(new k["d"]).scoreThreshold,e}return Object(b["a"])(t,e),Object(p["a"])(t,[{key:"startAutoProcess",value:function(){this.isAutoProcess=!0}},{key:"stopAutoProcess",value:function(){this.isAutoProcess=!1}},{key:"onScoreThresholdChnaged",value:function(e){R.setScoreThreshold(e),R.setForceDetect(!0)}},{key:"current",get:function(){return R.currentFrame},set:function(e){R.setCurrentFrame(e)}},{key:"total",get:function(){return Math.ceil(R.totalFrame)}},{key:"isAutoProcess",get:function(){return R.isAutoProcess},set:function(e){e?R.startAutoProcess():R.stopAutoProcess()}}]),t}(g["c"]);Object(y["c"])([Object(g["d"])("scoreThreshold")],A.prototype,"onScoreThresholdChnaged",null),A=Object(y["c"])([Object(g["a"])({components:{}})],A);var E=A,$=E,z=(n("6d13"),Object(s["a"])($,w,O,!1,null,"31a6b580",null)),L=z.exports,V=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-table",{staticClass:"detail-table",attrs:{data:e.currentData,columns:e.columns,striped:"",draggable:""},on:{dragstart:e.dragstart,drop:e.drop,dragover:e.dragover,dragleave:e.dragleave}})},B=[],H=function(e){function t(){var e;return Object(h["a"])(this,t),e=Object(m["a"])(this,Object(v["a"])(t).apply(this,arguments)),e.columns=[{field:"id",label:"ID",width:"40",numeric:!0},{field:"rect.x",label:"X",width:"40",numeric:!0},{field:"rect.y",label:"Y",width:"40",numeric:!0},{field:"rect.width",label:"W",width:"40",numeric:!0},{field:"rect.height",label:"H",width:"40",numeric:!0}],e.draggingRowIndex=-1,e}return Object(b["a"])(t,e),Object(p["a"])(t,[{key:"dragstart",value:function(e){this.draggingRow=e.row,this.draggingRowIndex=e.index,e.event.dataTransfer.effectAllowed="copy"}},{key:"dragover",value:function(e){e.event.dataTransfer.dropEffect="copy",this.setSelected(e.event.target,!0),e.event.preventDefault()}},{key:"dragleave",value:function(e){this.setSelected(e.event.target,!1),e.event.preventDefault()}},{key:"drop",value:function(e){this.setSelected(e.event.target,!1);var t=e.index;this.swapFaceIndex(this.draggingRowIndex,t)}},{key:"swapFaceIndex",value:function(e,t){var n=this.currentData,a=n[e],r=a.id;n[e].id=n[t].id,n[t].id=r,g["c"].set(n,e,n[t]),g["c"].set(n,t,a)}},{key:"setSelected",value:function(e,t){t?e.closest("tr").classList.add("is-selected"):e.closest("tr").classList.remove("is-selected")}},{key:"currentData",get:function(){var e=_.frames[R.currentFrame];return e||[]}}]),t}(g["c"]);H=Object(y["c"])([Object(g["a"])({components:{}})],H);var I=H,N=I,U=(n("8ef2"),Object(s["a"])(N,V,B,!1,null,"98256f88",null)),J=U.exports,X=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"wrapper"},[n("div",{staticClass:"editor"},[n("div",{staticClass:"scaler",style:e.scalerStyle},[n("video",{ref:"video",attrs:{muted:"",src:e.videoUrl},domProps:{muted:!0,currentTime:e.currentTime},on:{loadeddata:e.onVideoLoaded,seeked:e.onVideoSeeked}}),n("svg",{ref:"svg",staticClass:"overlay",attrs:{viewBox:e.svgViewBox},on:{mousedown:e.onSvgMouseDown,mousemove:e.onSvgMouseMove,mouseup:e.onSvgMouseUp,mouseleave:e.onSvgMouseLeave}},[e._l(e.faces,(function(t,a){return n("LandmarkEditorFace",{key:a,attrs:{face:t,rootSvg:e.$refs.svg,zoom:e.zoom}})})),e.newFaceRect.width>0?n("rect",{staticClass:"newrect",attrs:{x:e.newFaceRect.x,y:e.newFaceRect.y,width:e.newFaceRect.width,height:e.newFaceRect.height}}):e._e()],2)])]),n("div",{staticClass:"zoom-ui"},[n("b-tooltip",{attrs:{label:"Zoom Out (z)",type:"is-light",position:"is-right"}},[n("button",{directives:[{name:"shortkey",rawName:"v-shortkey",value:["z"],expression:"['z']"}],staticClass:"button",on:{click:e.zoomOut,shortkey:e.zoomOut}},[n("b-icon",{attrs:{icon:"magnify-minus"}})],1)]),n("b-tooltip",{attrs:{label:"Zoom In (x)",type:"is-light",position:"is-right"}},[n("button",{directives:[{name:"shortkey",rawName:"v-shortkey",value:["x"],expression:"['x']"}],staticClass:"button",on:{click:e.zoomIn,shortkey:e.zoomIn}},[n("b-icon",{attrs:{icon:"magnify-plus"}})],1)])],1)])},W=[],Y=(n("99af"),n("d81d"),n("6f22")),Z=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("g",[n("path",{staticClass:"svg-stroke",attrs:{d:e.allPath,"stroke-width":2/e.zoom}}),n("rect",{staticClass:"rect svg-stroke",style:{strokeWidth:e.isSelectedFace?3:1},attrs:{x:e.rect.x,y:e.rect.y,width:e.rect.width,height:e.rect.height},on:{mousedown:e.onRectMouseDown,mousemove:e.onRectMouseMove,mouseup:e.onRectMouseUp}}),n("text",{attrs:{x:e.rect.x,y:e.rect.y-2}},[e._v("ID: "+e._s(e.face.id))]),e._l(e.positions,(function(t,a){return n("circle",{key:a,attrs:{r:6/e.zoom,"stroke-width":4/e.zoom,draggable:"true",cx:t.x,cy:t.y},on:{mousedown:function(t){return e.onCircleMouseDown(t,a)},mousemove:function(t){return e.onCircleMouseMove(t,a)},mouseup:function(t){return e.onCircleMouseUp(t,a)},mouseleave:function(t){return e.onCircleMouseUp(t,a)}}})}))],2)},G=[],K=(n("fb6a"),n("4c53"),function(e){function t(){var e;return Object(h["a"])(this,t),e=Object(m["a"])(this,Object(v["a"])(t).apply(this,arguments)),e.selectedPoint=-1,e.rectMouseDown=new k["b"](-1,-1),e.faceMouseDown=e.face,e}return Object(b["a"])(t,e),Object(p["a"])(t,[{key:"mounted",value:function(){this.svgPoint=this.rootSvg.createSVGPoint()}},{key:"onRectMouseDown",value:function(e){e.preventDefault(),R.selectFace(this.face),this.rectMouseDown=this.getTransformedPoint(e.clientX,e.clientY),this.faceMouseDown=M(this.face)}},{key:"onRectMouseMove",value:function(e){var t=this;if(e.preventDefault(),!(this.rectMouseDown.x<0)){var n=this.getTransformedPoint(e.clientX,e.clientY),a=n.sub(this.rectMouseDown);this.face.rect.x=this.faceMouseDown.rect.x+a.x,this.face.rect.y=this.faceMouseDown.rect.y+a.y,this.face.landmarks=this.face.landmarks.map((function(e,n){var r=t.faceMouseDown.landmarks[n];return{x:r.x+a.x,y:r.y+a.y}}))}}},{key:"onRectMouseUp",value:function(e){this.rectMouseDown=new k["b"](-1,-1)}},{key:"onCircleMouseDown",value:function(e,t){e.preventDefault(),this.selectedPoint=t}},{key:"onCircleMouseMove",value:function(e,t){e.preventDefault(),this.selectedPoint===t&&this.updatePoint(t,this.getTransformedPoint(e.clientX,e.clientY))}},{key:"onCircleMouseUp",value:function(e,t){e.preventDefault(),this.selectedPoint===t&&this.updatePoint(t,this.getTransformedPoint(e.clientX,e.clientY)),this.selectedPoint=-1}},{key:"updatePoint",value:function(e,t){g["c"].set(this.positions,e,{x:t.x,y:t.y})}},{key:"getTransformedPoint",value:function(e,t){this.svgPoint.x=e,this.svgPoint.y=t;var n=this.svgPoint.matrixTransform(this.rootSvg.getScreenCTM().inverse());return new k["b"](n.x,n.y)}},{key:"pointToPath",value:function(e,t){var n="";return e.forEach((function(e,t){n+=0===t?"M".concat(e.x," ").concat(e.y," "):"L".concat(e.x," ").concat(e.y," ")})),n+=t?" Z ":" ",n}},{key:"positions",get:function(){return this.face.landmarks}},{key:"rect",get:function(){return this.face.rect}},{key:"isSelectedFace",get:function(){return this.face===R.faceSelected}},{key:"allPath",get:function(){var e="";return e+=this.pointToPath(this.face.landmarks.slice(0,17),!1),e+=this.pointToPath(this.face.landmarks.slice(17,22),!1),e+=this.pointToPath(this.face.landmarks.slice(22,27),!1),e+=this.pointToPath(this.face.landmarks.slice(27,36),!1),e+=this.pointToPath(this.face.landmarks.slice(36,42),!0),e+=this.pointToPath(this.face.landmarks.slice(42,48),!0),e+=this.pointToPath(this.face.landmarks.slice(48,68),!0),e}}]),t}(g["c"]));Object(y["c"])([Object(g["b"])({default:null})],K.prototype,"face",void 0),Object(y["c"])([Object(g["b"])({default:null})],K.prototype,"rootSvg",void 0),Object(y["c"])([Object(g["b"])({default:1})],K.prototype,"zoom",void 0),K=Object(y["c"])([Object(g["a"])({components:{}})],K);var q=K,Q=q,ee=(n("51ea"),Object(s["a"])(Q,Z,G,!1,null,"64d4058a",null)),te=ee.exports,ne=function(e){return{x:e.x,y:e.y,width:e.width,height:e.height}},ae=function(e){return{x:e.x,y:e.y}},re=function(e){function t(){var e;return Object(h["a"])(this,t),e=Object(m["a"])(this,Object(v["a"])(t).apply(this,arguments)),e.svgViewBox="0 0 1280 720",e.resolution=new k["a"](0,0),e.zoom=1,e.svgDownPoint=new k["b"](-1,-1),e.newFaceRect=new k["c"](0,0,0,0),e}return Object(b["a"])(t,e),Object(p["a"])(t,[{key:"mounted",value:function(){this.svgPoint=this.$refs.svg.createSVGPoint()}},{key:"onAutoProcessChanged",value:function(e){e&&R.nextBlankFrame()}},{key:"onForceDetectChanged",value:function(e){return regeneratorRuntime.async((function(t){while(1)switch(t.prev=t.next){case 0:if(!e){t.next=4;break}return t.next=3,regeneratorRuntime.awrap(this.detectFace(!1));case 3:R.setForceDetect(!1);case 4:case"end":return t.stop()}}),null,this)}},{key:"onVideoLoaded",value:function(){return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:return this.svgViewBox="0 0 ".concat(this.video.videoWidth," ").concat(this.video.videoHeight),this.resolution=new k["a"](this.video.videoWidth,this.video.videoHeight),R.setVideoDuration(this.video.duration),_.setMetaData({duration:this.video.duration,frames:R.totalFrame,width:this.video.videoWidth,height:this.video.videoHeight}),e.next=6,regeneratorRuntime.awrap(this.detectFace(!0));case 6:case"end":return e.stop()}}),null,this)}},{key:"onVideoSeeked",value:function(){return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(this.detectFace(!0));case 2:this.isAutoProcess&&R.nextFrame();case 3:case"end":return e.stop()}}),null,this)}},{key:"onSvgMouseDown",value:function(e){e.preventDefault(),e.srcElement===this.$refs.svg&&(R.selectFace(null),this.svgDownPoint=this.getTransformedPoint(e.clientX,e.clientY))}},{key:"onSvgMouseMove",value:function(e){if(e.preventDefault(),!(this.svgDownPoint.x<0)){var t=this.getTransformedPoint(e.clientX,e.clientY),n=this.svgDownPoint,a=new k["b"](Math.min(t.x,n.x),Math.min(t.y,n.y)),r=new k["b"](Math.max(t.x,n.x),Math.max(t.y,n.y));this.newFaceRect=new k["c"](a.x,a.y,r.x-a.x,r.y-a.y)}}},{key:"onSvgMouseUp",value:function(e){return regeneratorRuntime.async((function(t){while(1)switch(t.prev=t.next){case 0:if(e.preventDefault(),!(this.newFaceRect.width>10&&this.newFaceRect.height>10)){t.next=4;break}return t.next=4,regeneratorRuntime.awrap(this.createNewFace(this.newFaceRect));case 4:this.svgDownPoint=new k["b"](-1,-1),this.newFaceRect=new k["c"](0,0,0,0);case 6:case"end":return t.stop()}}),null,this)}},{key:"onSvgMouseLeave",value:function(e){return regeneratorRuntime.async((function(t){while(1)switch(t.prev=t.next){case 0:e.preventDefault(),this.svgDownPoint=new k["b"](-1,-1),this.newFaceRect=new k["c"](0,0,0,0);case 3:case"end":return t.stop()}}),null,this)}},{key:"createNewFace",value:function(e){var t,n,a;return regeneratorRuntime.async((function(r){while(1)switch(r.prev=r.next){case 0:return t=Object(Y["j"])({width:e.width,height:e.height}),Object(Y["o"])(t).drawImage(this.video,e.x,e.y,e.width,e.height,0,0,e.width,e.height),r.next=4,regeneratorRuntime.awrap(k["f"](t));case 4:n=r.sent,a={id:0,rect:ne(e),landmarks:n.positions.map((function(t){return{x:t.x+e.x,y:t.y+e.y}}))},R.addFace(a);case 7:case"end":return r.stop()}}),null,this)}},{key:"zoomIn",value:function(){this.zoom*=1.5}},{key:"zoomOut",value:function(){this.zoom*=2/3}},{key:"detectFace",value:function(e){var t,n,a;return regeneratorRuntime.async((function(r){while(1)switch(r.prev=r.next){case 0:if(t=R.currentFrame,!e||!this.faces){r.next=4;break}return console.log("use cache"),r.abrupt("return");case 4:return r.next=6,regeneratorRuntime.awrap(k["e"](this.video,this.options).withFaceLandmarks());case 6:n=r.sent,a=n.map((function(e,t){return{id:t,rect:ne(e.alignedRect.box),landmarks:e.landmarks.positions.map((function(e){return ae(e)}))}})),_.updateFrame({frame:t,faces:a});case 9:case"end":return r.stop()}}),null,this)}},{key:"getTransformedPoint",value:function(e,t){this.svgPoint.x=e,this.svgPoint.y=t;var n=this.svgPoint.matrixTransform(this.$refs.svg.getScreenCTM().inverse());return new k["b"](n.x,n.y)}},{key:"faces",get:function(){return _.frames[R.currentFrame]}},{key:"video",get:function(){return this.$refs.video}},{key:"videoUrl",get:function(){return R.videoUrl}},{key:"currentTime",get:function(){return R.currentTime}},{key:"isAutoProcess",get:function(){return R.isAutoProcess}},{key:"options",get:function(){return R.faceDetectorOptions}},{key:"forceDetect",get:function(){return R.forceDetect}},{key:"scalerStyle",get:function(){return{width:this.resolution.width+"px",height:this.resolution.height+"px",transform:"scale(".concat(this.zoom,")")}}}]),t}(g["c"]);Object(y["c"])([Object(g["d"])("isAutoProcess")],re.prototype,"onAutoProcessChanged",null),Object(y["c"])([Object(g["d"])("forceDetect")],re.prototype,"onForceDetectChanged",null),re=Object(y["c"])([Object(g["a"])({components:{LandmarkEditorFace:te}})],re);var oe=re,se=oe,ce=(n("b795"),Object(s["a"])(se,X,W,!1,null,"06ccb5a7",null)),ie=ce.exports,ue=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("nav",{staticClass:"navbar",attrs:{role:"navigation","aria-label":"main navigation"}},[n("div",{staticClass:"navbar-brand"},[n("div",{staticClass:"navbar-item"},[e._v("Landmark Editor")]),n("div",{staticClass:"navbar-start"},e._l(e.folders,(function(t){var a=t.name,r=t.items;return n("div",{staticClass:"navbar-item has-dropdown is-hoverable"},[n("div",{staticClass:"navbar-link"},[e._v(e._s(a))]),n("div",{staticClass:"navbar-dropdown"},e._l(r,(function(t){return n("a",{staticClass:"navbar-item",on:{click:t.method}},[e._v(e._s(t.name)),t.keymap?n("span",{directives:[{name:"shortkey",rawName:"v-shortkey",value:t.keymap,expression:"item.keymap"}],on:{shortkey:t.method}},[e._v(" ("+e._s(t.keymap.join("+"))+")")]):e._e()])})),0)])})),0)]),n("input",{ref:"input",attrs:{type:"file"},on:{change:e.onLoadFile}})])},le=[],fe=(n("2ca0"),n("21a6")),de=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"modal-card"},[e._m(0),n("section",{staticClass:"modal-card-body"},[n("h2",{staticClass:"is-size-5"},[e._v("Keyboard Shortcuts")]),n("table",{staticClass:"table is-bordered is-striped"},[e._m(1),n("tbody",e._l(e.shortcuts,(function(t){return n("tr",[n("td",[e._v(e._s(t[0]))]),n("td",[e._v(e._s(t[1]))])])})),0)])]),n("footer",{staticClass:"modal-card-foot"})])},he=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("header",{staticClass:"modal-card-head"},[n("p",{staticClass:"modal-card-title"},[e._v("Help")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("thead",[n("tr",[n("th",[e._v("Command")]),n("th",[e._v("Key")])])])}],pe=function(e){function t(){var e;return Object(h["a"])(this,t),e=Object(m["a"])(this,Object(v["a"])(t).apply(this,arguments)),e.shortcuts=[["Next Frame","."],["Prev Frame",","],["Zoom In","x"],["Zoom Out","z"],["Copy","ctrl + c"],["Paste","ctrl + v"],["Delete","backspace"]],e}return Object(b["a"])(t,e),t}(g["c"]);pe=Object(y["c"])([Object(g["a"])({components:{}})],pe);var me=pe,ve=me,be=Object(s["a"])(ve,de,he,!1,null,"2edee66a",null),ye=be.exports,ge=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"modal-card"},[e._m(0),n("section",{staticClass:"modal-card-body"},[n("b-field",{attrs:{label:"Frame Rate:"}},[n("b-numberinput",{attrs:{"controls-position":"compact",min:"1",max:"60",step:"0.01"},model:{value:e.fps,callback:function(t){e.fps=t},expression:"fps"}})],1)],1),n("footer",{staticClass:"modal-card-foot"})])},ke=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("header",{staticClass:"modal-card-head"},[n("p",{staticClass:"modal-card-title"},[e._v("Preferences")])])}],we=function(e){function t(){return Object(h["a"])(this,t),Object(m["a"])(this,Object(v["a"])(t).apply(this,arguments))}return Object(b["a"])(t,e),Object(p["a"])(t,[{key:"fps",get:function(){return R.fps},set:function(e){R.setFps(e)}}]),t}(g["c"]);we=Object(y["c"])([Object(g["a"])({components:{}})],we);var Oe=we,je=Oe,xe=Object(s["a"])(je,ge,ke,!1,null,"8b6cc5e6",null),Fe=xe.exports,Ce=function(e){function t(){var e;return Object(h["a"])(this,t),e=Object(m["a"])(this,Object(v["a"])(t).apply(this,arguments)),e.folders=[{name:"File",items:[{name:"Load Video",method:e.loadVideo,keymap:["ctrl","o"]},{name:"Load Json",method:e.loadJson},{name:"Save Json",method:e.saveJson,keymap:["ctrl","s"]}]},{name:"Edit",items:[{name:"Copy",method:e.onCopy,keymap:["ctrl","c"]},{name:"Paste",method:R.pasteFace,keymap:["ctrl","v"]},{name:"Delete",method:R.deleteFace,keymap:["backspace"]},{name:"Next Frame",method:R.nextFrame,keymap:["."]},{name:"Prev Frame",method:R.prevFrame,keymap:[","]},{name:"Preferences",method:e.showPreferences,keymap:["ctrl","."]}]},{name:"Help",items:[{name:"Show Help",method:e.showHelp,keymap:["shift","?"]}]}],e}return Object(b["a"])(t,e),Object(p["a"])(t,[{key:"loadVideo",value:function(){var e=this;this.$buefy.dialog.confirm({message:"Are you saved?",onConfirm:function(){var t=e.$refs.input;t.accept="video/*",t.click()}})}},{key:"loadJson",value:function(){var e=this;this.$buefy.dialog.confirm({message:"current landmarks will be overwritten.",onConfirm:function(){var t=e.$refs.input;t.accept="application/json",t.click()}})}},{key:"saveJson",value:function(){_.reduceDataSize(),Object(fe["saveAs"])(_.jsonBlob,"landmarks.json")}},{key:"onCopy",value:function(){R.faceSelected?(R.copyFace(),this.$buefy.toast.open("Copied")):this.$buefy.toast.open({message:"Select face to copy",type:"is-warning"})}},{key:"showHelp",value:function(){this.$buefy.modal.open({parent:this,component:ye,hasModalCard:!0})}},{key:"showPreferences",value:function(){this.$buefy.modal.open({parent:this,component:Fe,hasModalCard:!0})}},{key:"onLoadFile",value:function(e){var t=this,n=this.$refs.input;if(n.files&&0!==n.files.length){var a=n.files[0];a.type.startsWith("video")?R.loadVideo(a):a.type.startsWith("application/json")?_.loadJsonFile(a).catch((function(e){console.warn(e),t.showNotSupported()})):(console.log("unknown file",a),this.showNotSupported())}}},{key:"showNotSupported",value:function(){this.$buefy.dialog.alert("This file is not supported.")}}]),t}(g["c"]);Ce=Object(y["c"])([Object(g["a"])({components:{}})],Ce);var Pe=Ce,Se=Pe,De=(n("790c"),Object(s["a"])(Se,ue,le,!1,null,"04c59eef",null)),_e=De.exports,Me=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"timeline"},[n("svg",{staticClass:"scroller",style:e.svgStyle,attrs:{viewBox:e.svgViewBox}},[n("g",{attrs:{transform:"translate("+e.getPosX(e.current)+", 0)"}},[n("line",{staticClass:"current-position",attrs:{x1:"0",y1:"0",x2:"0",y2:e.frameHeight+e.labelHeight}}),n("text",{staticClass:"current-position-label",attrs:{x:"1",y:e.labelHeight-2}},[e._v(e._s(e.current))])]),n("g",e._l(e.labeledFrameCount,(function(t){return n("text",{staticClass:"frame-text",attrs:{x:e.getPosX(t*e.labelInterval),y:"0"}},[e._v(e._s(t*e.labelInterval))])})),0),n("g",{attrs:{transform:"translate(0, "+e.labelHeight+")"}},e._l(e.frames,(function(t,a){return n("rect",{staticClass:"frame",class:e.getFrameClass(t),attrs:{x:e.getPosX(a),y:"0",width:e.frameWidth-1,height:e.frameHeight},on:{click:function(){return e.current=a}}})})),0)])])},Te=[],Re=function(e){function t(){var e;return Object(h["a"])(this,t),e=Object(m["a"])(this,Object(v["a"])(t).apply(this,arguments)),e.frameWidth=5,e.frameHeight=15,e.labelHeight=10,e.labelInterval=50,e}return Object(b["a"])(t,e),Object(p["a"])(t,[{key:"getPosX",value:function(e){return e*this.frameWidth}},{key:"getFrameClass",value:function(e){if(!e)return"frame-null";var t=e.length;return 0===t?"frame-blank":1===t?"frame-1":2===t?"frame-2":"frame-many"}},{key:"current",get:function(){return R.currentFrame},set:function(e){R.setCurrentFrame(e)}},{key:"total",get:function(){return Math.ceil(R.totalFrame)}},{key:"labeledFrameCount",get:function(){return Math.floor(this.total/this.labelInterval)}},{key:"frames",get:function(){return _.frames}},{key:"svgViewBox",get:function(){return"0 0 ".concat(this.getPosX(this.total)," ").concat(this.frameHeight+20)}},{key:"svgStyle",get:function(){return{width:this.getPosX(this.total)+"px",height:this.frameHeight+40+"px"}}}]),t}(g["c"]);Re=Object(y["c"])([Object(g["a"])({components:{}})],Re);var Ae=Re,Ee=Ae,$e=(n("41ec"),Object(s["a"])(Ee,Me,Te,!1,null,"fdfecec0",null)),ze=$e.exports,Le=function(e){function t(){var e;return Object(h["a"])(this,t),e=Object(m["a"])(this,Object(v["a"])(t).apply(this,arguments)),e.isLoading=!0,e}return Object(b["a"])(t,e),Object(p["a"])(t,[{key:"mounted",value:function(){var e;return regeneratorRuntime.async((function(t){while(1)switch(t.prev=t.next){case 0:return e="models",t.next=3,regeneratorRuntime.awrap(k["h"](e));case 3:return t.next=5,regeneratorRuntime.awrap(k["g"](e));case 5:this.isLoading=!1,window.addEventListener("beforeunload",this.onBeforeUnload);case 7:case"end":return t.stop()}}),null,this)}},{key:"destroyed",value:function(){window.removeEventListener("beforeunload",this.onBeforeUnload)}},{key:"onBeforeUnload",value:function(e){e.preventDefault(),e.returnValue=!0}}]),t}(g["c"]);Le=Object(y["c"])([Object(g["a"])({components:{Controls:L,DetailTable:J,LandmarkEditor:ie,Menu:_e,Timeline:ze}})],Le);var Ve=Le,Be=Ve,He=(n("d8f5"),Object(s["a"])(Be,f,d,!1,null,"3754ea06",null)),Ie=He.exports;a["a"].use(l["a"]);var Ne=new l["a"]({mode:"history",base:"facial-landmark-annotation/",routes:[{path:"/",name:"home",component:Ie}]}),Ue=n("9483");Object(Ue["a"])("".concat("facial-landmark-annotation/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});var Je=n("289d"),Xe=(n("5abe"),n("3717"));a["a"].use(Je["a"]),a["a"].use(Xe),a["a"].config.productionTip=!1,new a["a"]({router:Ne,store:F,render:function(e){return e(u)}}).$mount("#app")},cf25:function(e,t,n){"use strict";var a=n("fea6"),r=n.n(a);r.a},d8f5:function(e,t,n){"use strict";var a=n("c690"),r=n.n(a);r.a},ea3f:function(e,t,n){},fea6:function(e,t,n){}});
//# sourceMappingURL=app.499cc35f.js.map